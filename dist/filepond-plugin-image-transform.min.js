/*!
 * FilePondPluginImageTransform 3.4.2
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).FilePondPluginImageTransform=e()}(this,function(){"use strict";var t={jpeg:"jpg","svg+xml":"svg"},e={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:function(){return[0,1,1,0,0,0]},6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},n=function(t,e){return{x:t,y:e}},i=function(t,e){return n(t.x-e.x,t.y-e.y)},r=function(t,e){return Math.sqrt(function(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(i(t,e),i(t,e))}(t,e))},a=function(t,e){var i=t,r=e,a=1.5707963267948966-e,o=Math.sin(1.5707963267948966),c=Math.sin(r),u=Math.sin(a),h=Math.cos(a),l=i/o;return n(h*(l*c),h*(l*u))},o=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:.5,y:.5},c=o.x>.5?1-o.x:o.x,u=o.y>.5?1-o.y:o.y,h=2*c*t.width,l=2*u*t.height,f=function(t,e){var i=t.width,o=t.height,c=a(i,e),u=a(o,e),h=n(t.x+Math.abs(c.x),t.y-Math.abs(c.y)),l=n(t.x+t.width+Math.abs(u.y),t.y+Math.abs(u.x)),f=n(t.x-Math.abs(u.y),t.y+t.height-Math.abs(u.x));return{width:r(h,l),height:r(h,f)}}(e,i);return Math.max(f.width/h,f.height/l)},c=function(t,e){var n=t.width,i=n*e;return i>t.height&&(n=(i=t.height)/e),{x:.5*(t.width-n),y:.5*(t.height-i),width:n,height:i}},u=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t.height/t.width,r=e,a=1,o=i;o>r&&(a=(o=r)/i);var c=Math.max(1/a,r/o),u=t.width/(n*c*a);return{width:u,height:u*e}},h=function(t){return t&&(t.horizontal||t.vertical)},l=function(t,n,i){if(n<=1&&!h(i))return t.width=t.naturalWidth,t.height=t.naturalHeight,t;var r=document.createElement("canvas"),a=t.naturalWidth,o=t.naturalHeight,c=n>=5&&n<=8;c?(r.width=o,r.height=a):(r.width=a,r.height=o);var u=r.getContext("2d");if(n&&u.transform.apply(u,function(t,n,i){return-1===i&&(i=1),e[i](t,n)}(a,o,n)),h(i)){var l=[1,0,0,1,0,0];(!c&&i.horizontal||c&i.vertical)&&(l[0]=-1,l[4]=a),(!c&&i.vertical||c&&i.horizontal)&&(l[3]=-1,l[5]=o),u.transform.apply(u,l)}return u.drawImage(t,0,0,a,o),r};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(i),r=n.length,a=new Uint8Array(r),o=0;o<r;o++)a[o]=n.charCodeAt(o);t(new Blob([a],{type:e||"image/png"}))})}}));var f=function(t,e){return m(t.x*e,t.y*e)},s=function(t,e){return m(t.x+e.x,t.y+e.y)},d=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return 0===e?{x:0,y:0}:m(t.x/e,t.y/e)},g=function(t,e,n){var i=Math.cos(e),r=Math.sin(e),a=m(t.x-n.x,t.y-n.y);return m(n.x+i*a.x-r*a.y,n.y+r*a.x+i*a.y)},m=function(){return{x:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0}},y=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0;return"string"==typeof t?parseFloat(t)*n:"number"==typeof t?t*(i?e[i]:Math.min(e.width,e.height)):void 0},v=function(t,e,n){var i=t.borderStyle||t.lineStyle||"solid",r=t.backgroundColor||t.fontColor||"transparent",a=t.borderColor||t.lineColor||"transparent",o=y(t.borderWidth||t.lineWidth,e,n);return{"stroke-linecap":t.lineCap||"round","stroke-linejoin":t.lineJoin||"round","stroke-width":o||0,"stroke-dasharray":"string"==typeof i?"":i.map(function(t){return y(t,e,n)}).join(","),stroke:a,fill:r,opacity:t.opacity||1}},p=function(t){return null!=t},w=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=y(t.x,e,n,"width")||y(t.left,e,n,"width"),r=y(t.y,e,n,"height")||y(t.top,e,n,"height"),a=y(t.width,e,n,"width"),o=y(t.height,e,n,"height"),c=y(t.right,e,n,"width"),u=y(t.bottom,e,n,"height");return p(r)||(r=p(o)&&p(u)?e.height-o-u:u),p(i)||(i=p(a)&&p(c)?e.width-a-c:c),p(a)||(a=p(i)&&p(c)?e.width-i-c:0),p(o)||(o=p(r)&&p(u)?e.height-r-u:0),{x:i||0,y:r||0,width:a||0,height:o||0}},x=function(t,e){return Object.keys(e).forEach(function(n){return t.setAttribute(n,e[n])})},M=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&x(n,e),n},T={contain:"xMidYMid meet",cover:"xMidYMid slice"},b={left:"start",center:"middle",right:"end"},A=function(t){return function(e){return M(t,{id:e.id})}},E={image:function(t){var e=M("image",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round",opacity:"0"});return e.onload=function(){e.setAttribute("opacity",t.opacity||1)},e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.src),e},rect:A("rect"),ellipse:A("ellipse"),text:A("text"),line:function(t){var e=M("g",{id:t.id,"stroke-linecap":"round","stroke-linejoin":"round"}),n=M("line");e.appendChild(n);var i=M("path");e.appendChild(i);var r=M("path");return e.appendChild(r),e}},O={rect:function(t){return x(t,Object.assign({},t.rect,t.styles))},ellipse:function(t){var e=t.rect.x+.5*t.rect.width,n=t.rect.y+.5*t.rect.height,i=.5*t.rect.width,r=.5*t.rect.height;return x(t,Object.assign({cx:e,cy:n,rx:i,ry:r},t.styles))},image:function(t,e){x(t,Object.assign({},t.rect,t.styles,{preserveAspectRatio:T[e.fit]||"none"}))},text:function(t,e,n,i){var r=y(e.fontSize,n,i),a=e.fontFamily||"sans-serif",o=e.fontWeight||"normal",c=b[e.textAlign]||"start";x(t,Object.assign({},t.rect,t.styles,{"stroke-width":0,"font-weight":o,"font-size":r,"font-family":a,"text-anchor":c})),t.text!==e.text&&(t.text=e.text,t.textContent=e.text.length?e.text:" ")},line:function(t,e,n,i){x(t,Object.assign({},t.rect,t.styles,{fill:"none"}));var r=t.childNodes[0],a=t.childNodes[1],o=t.childNodes[2],c=t.rect,u={x:t.rect.x+t.rect.width,y:t.rect.y+t.rect.height};if(x(r,{x1:c.x,y1:c.y,x2:u.x,y2:u.y}),e.lineDecoration){a.style.display="none",o.style.display="none";var h=d({x:u.x-c.x,y:u.y-c.y}),l=y(.05,n,i);if(-1!==e.lineDecoration.indexOf("arrow-begin")){var m=f(h,l),v=s(c,m),p=g(c,2,v),w=g(c,-2,v);x(a,{style:"display:block;",d:"M".concat(p.x,",").concat(p.y," L").concat(c.x,",").concat(c.y," L").concat(w.x,",").concat(w.y)})}if(-1!==e.lineDecoration.indexOf("arrow-end")){var M=f(h,-l),T=s(u,M),b=g(u,2,T),A=g(u,-2,T);x(o,{style:"display:block;",d:"M".concat(b.x,",").concat(b.y," L").concat(u.x,",").concat(u.y," L").concat(A.x,",").concat(A.y)})}}}},R=function(t,e){return t[1].zIndex>e[1].zIndex?1:-1},_=function(t,e,n){return new Promise(function(i){var r=new FileReader;r.onloadend=function(){var t=r.result,a=document.createElement("div");a.style.cssText="position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;",a.innerHTML=t;var u=a.querySelector("svg");document.body.appendChild(a);var h=u.getBBox();a.parentNode.removeChild(a);var l=a.querySelector("title"),f=u.getAttribute("viewBox")||"",s=u.getAttribute("width")||"",d=u.getAttribute("height")||"",g=parseFloat(s)||null,m=parseFloat(d)||null,y=(s.match(/[a-z]+/)||[])[0]||"",p=(d.match(/[a-z]+/)||[])[0]||"",x=f.split(" ").map(parseFloat),M=x.length?{x:x[0],y:x[1],width:x[2],height:x[3]}:h,T=null!=g?g:M.width,b=null!=m?m:M.height;u.style.overflow="visible",u.setAttribute("width",T),u.setAttribute("height",b);var A="";if(n&&n.length){var _={width:T,height:b};A=n.sort(R).reduce(function(t,e){var n,i,r=(n=e[0],i=e[1],E[n](i));return function(t,e,n,i,r){t.rect=w(n,i,r),t.styles=v(n,i,r),O[e](t,n,i,r)}(r,e[0],e[1],_),r.removeAttribute("id"),1===r.getAttribute("opacity")&&r.removeAttribute("opacity"),t+"\n"+r.outerHTML+"\n"},""),A="\n\n<g>".concat(A.replace(/&nbsp;/g," "),"</g>\n\n")}var I=e.aspectRatio||b/T,N=T,C=N*I,L=o({width:T,height:b},c({width:N,height:C},I),e.rotation,e.center),S=e.zoom*L,B=e.rotation*(180/Math.PI),U={x:.5*N,y:.5*C},P={x:U.x-T*e.center.x,y:U.y-b*e.center.y},F=["rotate(".concat(B," ").concat(U.x," ").concat(U.y,")"),"translate(".concat(U.x," ").concat(U.y,")"),"scale(".concat(S,")"),"translate(".concat(-U.x," ").concat(-U.y,")"),"translate(".concat(P.x," ").concat(P.y,")")],G=["scale(".concat(e.flip.horizontal?-1:1," ").concat(e.flip.vertical?-1:1,")"),"translate(".concat(e.flip.horizontal?-T:0," ").concat(e.flip.vertical?-b:0,")")],k='<?xml version="1.0" encoding="UTF-8"?>\n<svg width="'.concat(N).concat(y,'" height="').concat(C).concat(p,'" \nviewBox="0 0 ').concat(N," ").concat(C,'" \npreserveAspectRatio="xMinYMin"\nxmlns:xlink="http://www.w3.org/1999/xlink"\nxmlns="http://www.w3.org/2000/svg">\n\x3c!-- Generated by PQINA - https://pqina.nl/ --\x3e\n<title>').concat(l?l.textContent:"",'</title>\n<g transform="').concat(F.join(" "),'">\n<g transform="').concat(G.join(" "),'">\n').concat(u.outerHTML).concat(A,"\n</g>\n</g>\n</svg>");i(k)},r.readAsText(t)})},I=function(){var t={resize:function(t,e){var i=e.mode,o=void 0===i?"contain":i,c=e.upscale,u=void 0!==c&&c,h=e.width,l=e.height,f=e.matrix;if(f=!f||r(f)?null:f,!h&&!l)return a(t,f);null===h?h=l:null===l&&(l=h);if("force"!==o){var s=h/t.width,d=l/t.height,g=1;if("cover"===o?g=Math.max(s,d):"contain"===o&&(g=Math.min(s,d)),g>1&&!1===u)return a(t,f);h=t.width*g,l=t.height*g}for(var m=t.width,y=t.height,v=Math.round(h),p=Math.round(l),w=t.data,x=new Uint8ClampedArray(v*p*4),M=m/v,T=y/p,b=Math.ceil(.5*M),A=Math.ceil(.5*T),E=0;E<p;E++)for(var O=0;O<v;O++){for(var R=4*(O+E*v),_=0,I=0,N=0,C=0,L=0,S=0,B=0,U=(E+.5)*T,P=Math.floor(E*T);P<(E+1)*T;P++)for(var F=Math.abs(U-(P+.5))/A,G=(O+.5)*M,k=F*F,z=Math.floor(O*M);z<(O+1)*M;z++){var j=Math.abs(G-(z+.5))/b,D=Math.sqrt(k+j*j);if(D>=-1&&D<=1&&(_=2*D*D*D-3*D*D+1)>0){var q=w[(j=4*(z+P*m))+3];B+=_*q,N+=_,q<255&&(_=_*q/250),C+=_*w[j],L+=_*w[j+1],S+=_*w[j+2],I+=_}}x[R]=C/I,x[R+1]=L/I,x[R+2]=S/I,x[R+3]=B/N,f&&n(R,x,f)}return{data:x,width:v,height:p}},filter:a},e=function(e,n){var i=e.transforms,r=null;if(i.forEach(function(t){"filter"===t.type&&(r=t)}),r){var a=null;i.forEach(function(t){"resize"===t.type&&(a=t)}),a&&(a.data.matrix=r.data,i=i.filter(function(t){return"filter"!==t.type}))}n(function(e,n){return e.forEach(function(e){n=t[e.type](n,e.data)}),n}(i,e.imageData))};function n(t,e,n){for(var i=0,r=0,a=0,o=e[t]/255,c=e[t+1]/255,u=e[t+2]/255,h=e[t+3]/255;i<4;i++)a=255*(o*n[r=5*i]+c*n[r+1]+u*n[r+2]+h*n[r+3]+n[r+4]),e[t+i]=Math.max(0,Math.min(a,255))}self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})};var i=self.JSON.stringify([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);function r(t){return self.JSON.stringify(t||[])===i}function a(t,e){if(!e||r(e))return t;for(var n=t.data,i=n.length,a=e[0],o=e[1],c=e[2],u=e[3],h=e[4],l=e[5],f=e[6],s=e[7],d=e[8],g=e[9],m=e[10],y=e[11],v=e[12],p=e[13],w=e[14],x=e[15],M=e[16],T=e[17],b=e[18],A=e[19],E=0,O=0,R=0,_=0,I=0;E<i;E+=4)O=n[E]/255,R=n[E+1]/255,_=n[E+2]/255,I=n[E+3]/255,n[E]=Math.max(0,Math.min(255*(O*a+R*o+_*c+I*u+h),255)),n[E+1]=Math.max(0,Math.min(255*(O*l+R*f+_*s+I*d+g),255)),n[E+2]=Math.max(0,Math.min(255*(O*m+R*y+_*v+I*p+w),255)),n[E+3]=Math.max(0,Math.min(255*(O*x+R*M+_*T+I*b+A),255));return t}},N=function(t,e,n){if(1165519206===t.getUint32(e+4,!1)){e+=4;var i=18761===t.getUint16(e+=6,!1);e+=t.getUint32(e+4,i);var r=t.getUint16(e,i);e+=2;for(var a=0;a<r;a++)if(274===t.getUint16(e+12*a,i))return t.setUint16(e+12*a+8,1,i),!0;return!1}},C=function(t){return new Promise(function(e,n){var i=new FileReader;i.onload=function(){return e(function(t){var e=new DataView(t);if(65496!==e.getUint16(0))return null;for(var n,i,r=2,a=!1;r<e.byteLength&&(n=e.getUint16(r,!1),i=e.getUint16(r+2,!1)+2,n>=65504&&n<=65519||65534===n)&&(a||(a=N(e,r)),!(r+i>e.byteLength));)r+=i;return t.slice(0,r)}(i.result)||null)},i.readAsArrayBuffer(t.slice(0,262144))})},L=function(t,e){var n=window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(n){var i=new n;return i.append(t),i.getBlob(e)}return new Blob([t],{type:e})},S=function(t){var e=new Blob(["(",t.toString(),")()"],{type:"application/javascript"}),n=URL.createObjectURL(e),i=new Worker(n);return{transfer:function(t,e){},post:function(t,e,n){var r=Math.random().toString(36).substr(2,9);i.onmessage=function(t){t.data.id===r&&e(t.data.message)},i.postMessage({id:r,message:t},n)},terminate:function(){i.terminate(),URL.revokeObjectURL(n)}}},B=function(t,e){return new Promise(function(n){var i,r={width:t.width,height:t.height},a=t.getContext("2d"),o=e.sort(R).map(function(t){return function(){return new Promise(function(e){F[t[0]](a,r,t[1],e)&&e()})}});(i=o,i.reduce(function(t,e){return t.then(function(t){return e().then(Array.prototype.concat.bind(t))})},Promise.resolve([]))).then(function(){return n(t)})})},U=function(t,e){t.beginPath(),t.lineCap=e["stroke-linecap"],t.lineJoin=e["stroke-linejoin"],t.lineWidth=e["stroke-width"],e["stroke-dasharray"].length&&t.setLineDash(e["stroke-dasharray"].split(",")),t.fillStyle=e.fill,t.strokeStyle=e.stroke,t.globalAlpha=e.opacity||1},P=function(t){t.fill(),t.stroke(),t.globalAlpha=1},F={rect:function(t,e,n){var i=w(n,e),r=v(n,e);return U(t,r),t.rect(i.x,i.y,i.width,i.height),P(t),!0},ellipse:function(t,e,n){var i=w(n,e),r=v(n,e);U(t,r);var a=i.x,o=i.y,c=i.width,u=i.height,h=c/2*.5522848,l=u/2*.5522848,f=a+c,s=o+u,d=a+c/2,g=o+u/2;return t.moveTo(a,g),t.bezierCurveTo(a,g-l,d-h,o,d,o),t.bezierCurveTo(d+h,o,f,g-l,f,g),t.bezierCurveTo(f,g+l,d+h,s,d,s),t.bezierCurveTo(d-h,s,a,g+l,a,g),P(t),!0},image:function(t,e,n,i){var r=w(n,e),a=v(n,e);U(t,a);var o=new Image;o.onload=function(){if("cover"===n.fit){var e=r.width/r.height,a=e>1?o.width:o.height*e,c=e>1?o.width/e:o.height,u=.5*o.width-.5*a,h=.5*o.height-.5*c;t.drawImage(o,u,h,a,c,r.x,r.y,r.width,r.height)}else if("contain"===n.fit){var l=Math.min(r.width/o.width,r.height/o.height),f=l*o.width,s=l*o.height,d=r.x+.5*r.width-.5*f,g=r.y+.5*r.height-.5*s;t.drawImage(o,0,0,o.width,o.height,d,g,f,s)}else t.drawImage(o,0,0,o.width,o.height,r.x,r.y,r.width,r.height);P(t),i()},o.src=n.src},text:function(t,e,n){var i=w(n,e),r=v(n,e);U(t,r);var a=y(n.fontSize,e),o=n.fontFamily||"sans-serif",c=n.fontWeight||"normal",u=n.textAlign||"left";return t.font="".concat(c," ").concat(a,"px ").concat(o),t.textAlign=u,t.fillText(n.text,i.x,i.y),P(t),!0},line:function(t,e,n){var i=w(n,e),r=v(n,e);U(t,r),t.beginPath();var a={x:i.x,y:i.y},o={x:i.x+i.width,y:i.y+i.height};t.moveTo(a.x,a.y),t.lineTo(o.x,o.y);var c=d({x:o.x-a.x,y:o.y-a.y}),u=.04*Math.min(e.width,e.height);if(-1!==n.lineDecoration.indexOf("arrow-begin")){var h=f(c,u),l=s(a,h),m=g(a,2,l),y=g(a,-2,l);t.moveTo(m.x,m.y),t.lineTo(a.x,a.y),t.lineTo(y.x,y.y)}if(-1!==n.lineDecoration.indexOf("arrow-end")){var p=f(c,-u),x=s(o,p),M=g(o,2,x),T=g(o,-2,x);t.moveTo(M.x,M.y),t.lineTo(o.x,o.y),t.lineTo(T.x,T.y)}return P(t),!0}},G=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(i,r){if(!t||!function(t){return/^image/.test(t.type)}(t))return r();var a=n.stripImageHead,h=n.beforeCreateBlob,f=n.afterCreateBlob,s=n.canvasMemoryLimit,d=e.crop,g=e.size,m=e.filter,y=e.markup,v=e.output,p=e.image&&e.image.orientation?Math.max(1,Math.min(8,e.image.orientation)):null,w=v&&v.quality,x=null===w?null:w/100,M=v&&v.type||null,T=[];!g||"number"!=typeof g.width&&"number"!=typeof g.height||T.push({type:"resize",data:g}),m&&20===m.length&&T.push({type:"filter",data:m});var b=function(t){var e=f?f(t):t;Promise.resolve(e).then(i)},A=function(t,e){var n=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t,0,0),e}(t),i=y.length?B(n,y):n;Promise.resolve(i).then(function(t){(function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(i){var r=n?n(t):t;Promise.resolve(r).then(function(t){t.toBlob(i,e.type,e.quality)})})})(t,e,h).then(function(t){if(a)return b(t);C(t).then(function(e){null!==e&&(t=new Blob([e,t.slice(20)],{type:t.type})),b(t)})}).catch(r)})};if(/svg/.test(t.type)&&null===M)return _(t,d,y).then(function(t){i(L(t,"image/svg+xml"))});var E=URL.createObjectURL(t);(function(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=function(t){n(t)},i.src=t})})(E).then(function(e){URL.revokeObjectURL(E);var n=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).canvasMemoryLimit,r=n.zoom||1,a=l(t,e,n.flip),h={width:a.width,height:a.height},f=n.aspectRatio||h.height/h.width,s=u(h,f,r);if(i){var d=s.width*s.height;if(d>i){var g=Math.sqrt(i)/Math.sqrt(d);h.width=Math.floor(h.width*g),h.height=Math.floor(h.height*g),s=u(h,f,r)}}var m=document.createElement("canvas"),y={x:.5*s.width,y:.5*s.height},v={x:0,y:0,width:s.width,height:s.height,center:y},p=r*o(h,c(v,f),n.rotation,n.center);m.width=Math.round(s.width/p),m.height=Math.round(s.height/p),y.x/=p,y.y/=p;var w=y.x-h.width*(n.center?n.center.x:.5),x=y.y-h.height*(n.center?n.center.y:.5),M=m.getContext("2d");return M.translate(y.x,y.y),M.rotate(n.rotation||0),M.drawImage(a,w-y.x,x-y.y,h.width,h.height),M.getImageData(0,0,m.width,m.height)}(e,p,d,{canvasMemoryLimit:s}),i={quality:x,type:M||t.type};if(!T.length)return A(n,i);var r=S(I);r.post({transforms:T,imageData:n},function(t){A(function(t){var e;try{e=new ImageData(t.width,t.height)}catch(n){e=document.createElement("canvas").getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e}(t),i),r.terminate()},[n.data.buffer])})})};"undefined"!=typeof window&&void 0!==window.document&&(HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var i=this;setTimeout(function(){for(var r=i.toDataURL(e,n).split(",")[1],a=atob(r),o=a.length,c=new Uint8Array(o);o--;)c[o]=a.charCodeAt(o);t(new Blob([c],{type:e||"image/png"}))})}}));var k="undefined"!=typeof window&&void 0!==window.document,z=k&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,j=function(e){var n=e.addFilter,i=e.utils,r=i.Type,a=i.forin,o=i.getFileFromBlob,c=i.isFile,u=["crop","resize","filter","markup","output"],h=function(t){return null===t.aspectRatio&&0===t.rotation&&1===t.zoom&&t.center&&.5===t.center.x&&.5===t.center.y&&t.flip&&!1===t.flip.horizontal&&!1===t.flip.vertical};return n("SHOULD_PREPARE_OUTPUT",function(t,e){var n=e.query;return new Promise(function(t){t(!n("IS_ASYNC"))})}),n("PREPARE_OUTPUT",function(e,n){var i=n.query,r=n.item;return new Promise(function(n){if(!c(e)||!function(t){return/^image/.test(t.type)}(e)||!i("GET_ALLOW_IMAGE_TRANSFORM")||r.archived)return n(e);var l=[];i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL")&&l.push(function(){return new Promise(function(t){t({name:i("GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME"),file:e})})}),i("GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT")&&l.push(function(t,e,n){return new Promise(function(r){t(e,n).then(function(t){return r({name:i("GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME"),file:t})})})});var f=i("GET_IMAGE_TRANSFORM_VARIANTS")||{};a(f,function(t,e){var n,i=(n=e,function(t,e,i){return t(e,n?n(i):i)});l.push(function(e,n,r){return new Promise(function(a){i(e,n,r).then(function(e){return a({name:t,file:e})})})})});var s=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),d=i("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE"),g=null===s?null:s/100,m=i("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),y=i("GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS")||u;r.setMetadata("output",{type:m,quality:g,client:y},!0);var v=function(e,n){return new Promise(function(r,a){var c=Object.assign({},n);Object.keys(c).filter(function(t){return"exif"!==t}).forEach(function(t){-1===y.indexOf(t)&&delete c[t]});var u=c.resize,l=c.exif,f=c.output,s=c.crop,g=c.filter,m=c.markup,v={image:{orientation:l?l.orientation:null},output:f?{type:f.type,quality:f.quality?100*f.quality:null}:void 0,size:u&&(u.size.width||u.size.height)?Object.assign({mode:u.mode,upscale:u.upscale},u.size):void 0,crop:s&&!h(s)?Object.assign({},s):void 0,markup:m||[],filter:g};if(v.output){var p=f.type&&f.type!==e.type,w=!!(v.size||v.crop||v.filter||p);if(f.quality&&"optional"===d&&!w)return r(e)}var x={beforeCreateBlob:i("GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB"),afterCreateBlob:i("GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB"),canvasMemoryLimit:i("GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT"),stripImageHead:i("GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD")};G(e,v,x).then(function(n){var i,a=o(n,function(e,n){var i=function(t){return t.substr(0,t.lastIndexOf("."))||t}(e),r=n.split("/")[1],a=t[r]||r;return"".concat(i,".").concat(a)}(e.name,(i=n.type,/jpeg|png|svg\+xml/.test(i)?i:"image/jpeg")));r(a)}).catch(a)})},p=l.map(function(t){return t(v,e,r.getMetadata())});Promise.all(p).then(function(t){n(1===t.length&&null===t[0].name?t[0].file:t)})})}),{options:{allowImageTransform:[!0,r.BOOLEAN],imageTransformOutputMimeType:[null,r.STRING],imageTransformOutputQuality:[null,r.INT],imageTransformOutputStripImageHead:[!0,r.BOOLEAN],imageTransformClientTransforms:[null,r.ARRAY],imageTransformOutputQualityMode:["always",r.STRING],imageTransformVariants:[null,r.OBJECT],imageTransformVariantsIncludeDefault:[!0,r.BOOLEAN],imageTransformVariantsDefaultName:[null,r.STRING],imageTransformVariantsIncludeOriginal:[!1,r.BOOLEAN],imageTransformVariantsOriginalName:["original_",r.STRING],imageTransformBeforeCreateBlob:[null,r.FUNCTION],imageTransformAfterCreateBlob:[null,r.FUNCTION],imageTransformCanvasMemoryLimit:[k&&z?16777216:null,r.INT]}}};return k&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:j})),j});
