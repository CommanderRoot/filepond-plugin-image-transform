/*
 * FilePondPluginImageTransform 1.1.1
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.FilePondPluginImageTransform=e()}(this,function(){"use strict";var t=function(t){return/^image/.test(t.type)},e=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,a){var u={key:t,arg:e,resolve:n,reject:a,next:null};i?i=i.next=u:(o=i=u,r(t,e))})}function r(n,o){try{var i=e[n](o),u=i.value;u instanceof t?Promise.resolve(u.value).then(function(t){r("next",t)},function(t){r("throw",t)}):a(i.done?"return":"normal",i.value)}catch(c){a("throw",c)}}function a(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?r(o.key,o.arg):i=null}var o,i;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}),n={1:function(){return[1,0,0,1,0,0]},2:function(t){return[-1,0,0,1,t,0]},3:function(t,e){return[-1,0,0,-1,t,e]},4:function(t,e){return[1,0,0,-1,0,e]},5:[0,1,1,0,0,0],6:function(t,e){return[0,1,-1,0,e,0]},7:function(t,e){return[0,-1,-1,0,e,t]},8:function(t){return[0,-1,1,0,0,t]}},r=function(t,r,a,o){o!==-1&&t.transform.apply(t,e(n[o](r,a)))},a=function(t,e,n){e||(e={x:0,y:0,width:1,height:1});var a=document.createElement("canvas"),o=t.naturalWidth,i=t.naturalHeight;n>=5&&n<=8?(a.width=i,a.height=o):(a.width=o,a.height=i);var u=a.getContext("2d");u.save(),r(u,o,i,n),u.drawImage(t,0,0,o,i),u.restore();var c=u.getImageData(Math.round(e.x*a.width),Math.round(e.y*a.height),Math.round(e.width*a.width),Math.round(e.height*a.height));return c},o=function(t,e){return new Promise(function(n,r){var a=document.createElement("canvas");a.width=t.width,a.height=t.height;var o=a.getContext("2d");o.putImageData(t,0,0),a.toBlob(n,e.type,e.quality)})},i=function(t){var e=void 0;try{e=new ImageData(t.width,t.height)}catch(n){var r=document.createElement("canvas");e=r.getContext("2d").createImageData(t.width,t.height)}return e.data.set(t.data),e},u=function(){function t(t,e){var n=e.mode,r=e.upscale,a=e.size,o=a.width,i=a.height;if(null===o?o=i:null===i&&(i=o),"force"!==n){var u=o/t.width,c=i/t.height,f=1;if("cover"===n?f=Math.max(u,c):"contain"===n&&(f=Math.min(u,c)),f>1&&r===!1)return t;o=t.width*f,i=t.height*f}for(var h=t.width,l=t.height,s=Math.round(o),d=Math.round(i),g=t.data,m=new Uint8ClampedArray(s*d*4),v=h/s,p=l/d,y=Math.ceil(v/2),w=Math.ceil(p/2),M=0;M<d;M++)for(var _=0;_<s;_++){for(var x=4*(_+M*s),T=0,b=0,E=0,A=gx_g=gx_b=gx_a=0,I=(M+.5)*p,O=Math.floor(M*p);O<(M+1)*p;O++)for(var P=Math.abs(I-(O+.5))/w,R=(_+.5)*v,U=P*P,L=Math.floor(_*v);L<(_+1)*v;L++){var j=Math.abs(R-(L+.5))/y,k=Math.sqrt(U+j*j);k>=-1&&k<=1&&(T=2*k*k*k-3*k*k+1,T>0&&(j=4*(L+O*h),gx_a+=T*g[j+3],E+=T,g[j+3]<255&&(T=T*g[j+3]/250),A+=T*g[j],gx_g+=T*g[j+1],gx_b+=T*g[j+2],b+=T))}m[x]=A/b,m[x+1]=gx_g/b,m[x+2]=gx_b/b,m[x+3]=gx_a/E}return{data:m,width:s,height:d}}var e={resize:t},n=function(t,n){return t.forEach(function(t){n=e[t.type](n,t.data)}),n},r=function(t,e){var r=n(t.transforms,t.imageData);e(r)};self.onmessage=function(t){r(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e.data.buffer])})}};HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){var r=this;setTimeout(function(){for(var a=r.toDataURL(e,n).split(",")[1],o=atob(a),i=o.length,u=new Uint8Array(i);i--;)u[i]=o.charCodeAt(i);t(new Blob([u],{type:e||"image/png"}))})}});var c=function(e){var n=e.addFilter,r=e.utils,c=r.Type,f=r.forin,h=r.loadImage,l=r.getFileFromBlob,s=r.getFilenameWithoutExtension,d=r.createWorker,g=r.isFile,m=function(t,e){var n=s(t),r="image/jpeg"===e?"jpg":e.split("/")[1];return n+"."+r},v=function(t){return"image/jpeg"===t||"image/png"===t?t:"image/jpeg"},p=["resize"];return n("PREPARE_OUTPUT",function(e,n){var r=n.query,c=n.item;return new Promise(function(n,s){if(!g(e)||!t(e)||!r("GET_ALLOW_IMAGE_TRANSFORM"))return n(e);var y=r("GET_IMAGE_TRANSFORM_OUTPUT_QUALITY"),w=null===y?null:y/100,M=r("GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE"),_=c.getMetadata(),x=_.crop,T=[];if(f(c.getMetadata(),function(t,e){p.includes(t)&&T.push({type:t,data:e})}),null===w&&null===M&&!x&&!T.length)return n(e);var b=function(t,r){o(t,r).then(function(t){var r=l(t,m(e.name,v(t.type)));n(r)})["catch"](function(t){console.error(t)})},E=URL.createObjectURL(e);h(E).then(function(t){URL.revokeObjectURL(E);var n=(c.getMetadata("exif")||{}).orientation||-1,r=a(t,x?x.rect:null,n);if(!T.length)return void b(r,{quality:w,type:M||e.type});var o=d(u);o.post({transforms:T,imageData:r},function(t){b(i(t),{quality:w,type:M||e.type}),o.terminate()},[r.data.buffer])})})}),{options:{allowImageTransform:[!0,c.BOOLEAN],imageTransformOutputMimeType:[null,c.STRING],imageTransformOutputQuality:[null,c.INT]}}};return"undefined"!=typeof navigator&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:c})),c});